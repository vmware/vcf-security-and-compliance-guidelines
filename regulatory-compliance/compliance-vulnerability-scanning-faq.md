# Compliance & Vulnerability Scanning Q&A
Many customers employ security & compliance scanning tools to assist them during audits of their environments. This is a collection of common questions posed to VMware about this process.

## Can Broadcom recommend a vulnerability scanning tool?
Consider the Symantec Data Center Security tools, which have vulnerability management capabilities.

## I am attempting to use a vulnerability scanning tool and it is not working.
While we don't directly support scanning tools, we do support the use of approved APIs and clients. We recommend choosing a solution that specifically lists VMware Cloud Foundation (VCF) as a supported scanning target, as this indicates the vendor understands the VCF architecture and deployment model.

## The tool I am using relied on PowerCLI to scan my environment. Is that supported?
PowerCLI is a CLI tool that is supported by Broadcom. However, help with your scripting/coding itselfis available through the Broadcom Developer Community or Professional Services if needed. Third-party tools and scripts are not supported by Broadcom; please contact that vendor directly.

## PowerCLI does not appear to be working in conjunction with the scanning tool I am using.
While we cannot provide support for third-party tools, there are several things you can try, based on our own experiences:

- Ensure that PowerCLI works on its own and does not have errors.
- Ensure that your own IT Security team has not blocked PowerShell execution as a security measure. While blocking PowerShell is a valid technique for most non-administrative users, it does interfere with the legitimate use of PowerCLI as a powerful administrative tool for trusted system administrators (who already have trusted access to the infrastructure and all organizational data contained therein).
- Install the latest version of PowerCLI, using instructions from the [Broadcom Developer Portal](https://developer.broadcom.com/powercli). You may wish to remove all older versions of PowerCLI from your system prior to installing a new copy of the latest version.
- Install the latest version of PowerShell itself. If you do this you may need to reinstall PowerCLI with this new version. You might also investigate the Microsoft Terminal application which is a nice interface for PowerShell.
- Test to ensure that you can connect to your vCenter Server and run PowerCLI commands. Use "Connect-VIServer" to connect to vCenter Server using the credentials for your scanner.
- If you encounter certificate errors, you may need to use "Set-PowerCLIConfiguration -InvalidCertificateAction Ignore" to ignore the certificate errors.
- It is also possible, if your VCF environment is configured with one of the NIST_2024 TLS profiles and/or has FIPS 140-3 support enabled, that your workstation does not support the TLS ciphers VCF is trying to use. You can double-check this by accessing the vSphere Client itself using a web browser. If it works this likely isn't the issue.
- Run commands like "Get-VM" and "Get-VMHost" to ensure that PowerCLI is working properly and returning data.

## My scanning tool is asking me whether ESX is Linux or UNIX. Which one should I pick?
VMware ESX is its own distinct operating system - it is neither Linux nor UNIX. If your scanning tool doesn't specifically support VMware Cloud Foundation components you should either avoid using it on your environment or limit it to network-based scanning only. Attempting to scan ESX as if it were a Linux or UNIX host will, at best, generate false positives and waste staff time investigating these incorrect findings.

## What is the best way to scan via SSH?
SSH and command shells (ESX Shell) on VCF components, like ESX and vCenter Server, are maintenance and support tools designed for temporary use only. ESX ships with both SSH and the ESX Shell disabled by default, and vCenter Server raises alarms if either is enabled and running. Neither is intended for operational use on the host. That said, if you must scan these components, we recommend enabling shells for the duration of the scan, then disabling them afterwards.

There are no customer-serviceable components inside VCF appliances. For example,ESX is delivered and maintained as a single software image, similar to network switch firmware, and modifying permissions or software within that image may impact both system availability and supportability.

We strongly recommend keeping SSH disabled and having scanning tools check version information to determine if updates are available.

## What distribution of Linux do vCenter Server, SDDC Manager, and other appliances use?
[Photon Linux](https://vmware.github.io/photon/) is the foundation of most appliances. Photon Linux is a Linux distribution maintained by Broadcom. VCF appliances may use different generations of Photon Linux.

While VCF components are built on Linux, they are not general-purpose computing platforms and should not be treated as such. Modifying them in any way outside of official guidance is unsupported. These appliances are designed to be updated only through official APIs and interfaces.

It's more appropriate to think of these appliances like network switch firmware, where the OS would be listed in a CMDB as "VMware vCenter" rather than a Linux distribution. This perspective helps change management teams and other organizational staff understand that these appliances require different management approaches than typical Linux systems.

## Can I patch VMware Cloud Foundation appliance Linux installations?
While it may be possible to run the internal Linux patching commands, such as yum, on these appliances, it is neither recommended nor supported. Always use the official VMware Cloud Foundation and VMware vSphere patching tools to patch these appliances.

## My scanner says it found insecure TLS ciphers. Am I vulnerable?
Probably not.

Security scanners are designed to identify all potential vulnerabilities in a system and cast a wide net in doing so. They typically flag anything as a vulnerability if it doesn't specifically match their known "good state." While this thoroughness is generally beneficial, it means that a human needs to review the report and determine if each finding represents a genuine vulnerability. Unfortunately, most people reviewing these reports aren't experts in cryptographic details.

When evaluating TLS ciphers, scanners rely on current best-practice guidance. If they find a cipher that isn't listed in their current recommendations, they'll flag it as a vulnerability. However, scanners don't consider factors like interoperability, backward compatibility, performance, or other system design and operational requirements.

vSphere uses TLS 1.3 for communication, with TLS 1.2 as a fallback, unless you've explicitly configured an insecure connection (see [Network Encryption in VMware vSphere 8](https://github.com/vmware/vcf-security-and-compliance-guidelines/blob/main/regulatory-compliance/vsphere/8.0/VMware-vSphere-8-Network-Encryption.md) for details). We've thoroughly evaluated the default cipher configurations and don't consider any of them to be insecure or vulnerable. These defaults are re-evaluated with each major release.

However, cryptographic standards evolve, and newer ciphers may offer improved security when your environment can support them. For this reason, we've introduced TLS Profiles in vSphere 8.0.3 and later versions, allowing you to enable modern, NIST-compliant ciphers, as well as to disable fallback to TLS 1.2. For implementation guidance, consult the [Security Configuration Guide](https://brcm.tech/vcf-scg) and/or the product documentation.

## My scanner says it found web servers that don't use HSTS. Am I vulnerable?
Probably not.

HSTS (HTTP Strict Transport Security) is a web security feature that helps protect against attacks attempting to downgrade a website's security. It's a feature of the HTTP protocol and isn't specific to vSphere or VMware. While HSTS enforcement is supported by modern browsers and is browser-driven, this actually makes it a relatively weak way to establish trust inside a system like vSphere, especially when connections aren't coming from browsers.

When a browser first visits a website, it receives an HSTS header from the server. The browser stores this information and uses it on subsequent visits to determine if the website should be accessed securely.

This approach has several limitations:
1. There's a "bootstrapping" problem - you have to trust the website on your first visit
2. It relies on browser caches, so clearing your cache removes all HSTS data
3. It doesn't provide any additional certificate validation beyond what browsers normally do

Since HSTS is a browser technology, VMware products support it only on interfaces designed for browser access - typically port 443/TCP for management UIs and port 5480/TCP for VAMI/appliance management.

TLS is used on other internal network ports on components across all VMware products, which is likely what your scanner has noticed. **These ports do not use HSTS because they are not browser-facing and do not use HTTP, making HSTS inapplicable.** VMware Cloud Foundation components use other, more robust methods to establish trust between components.

**While all web servers may use TLS nowadays, TLS is not always found on a web server!**

## My scanner says it found vulnerabilities or other issues. How do I fix those?
Broadcom tracks all software installed and used within our products. When security or functional issues are reported in external projects, VMware assesses their impact according to the VMware Security Response Policy (below). If necessary, product updates are made available through supported update mechanisms following the response policy schedule.

Scanners can make mistakes, and reported issues need careful investigation. For example, many scanners test for specific malware or web shells. When web applications redirect requests to landing pages or login screens, scanners may misinterpret these redirects as vulnerabilities if they don't receive an expected "404 File Not Found" response. While these findings warrant investigation, they don't always indicate actual vulnerabilities.

If you're uncertain about an issue or its severity, please open a case with VMware Global Support. They can help validate the report and escalate to VMware Product Security staff as necessary.

Modifying file permissions or software components without explicit guidance from VMware Global Support is unsupported and may impact:
- System availability
- Serviceability
- Support status of your infrastructure

VMware is committed to the security and stability of our products and customers. If you have concerns, the first step should be opening a support case with VMware Global Support.

- [VMware Product Security: An Overview of VMware's Security Programs and Practices](https://www.vmware.com/docs/vmware-product-security-white-paper)
- [VMware External Vulnerability Response and Remediation Policy](https://www.broadcom.com/support/vmware-services/security-response)

## My scanning tool discovered permission problems when scanning ESX. How do I fix those?
ESX is neither Linux nor UNIX and does not follow their permission models. Because SSH and the ESX Shell are intended for maintenance only, and ESX is not a traditional multiuser operating system, users logging in through these mechanisms intentionally have administrator/root-level permissions.

ESX 7 and newer loads its operating system image into a RAMdisk at system boot. Any direct changes to configuration files will not persist across system reboots. Use documented APIs and methods to make changes to the configuration of ESX and other components.

## My scanning tool discovered a vulnerability in an appliance component, and I replaced the package with one from another Linux distribution. Now things don't work right. How do I fix this?
Manually changing components is unsupported and can cause severe availability and functionality problems. Please open a support case with VMware Global Support for assistance.

## If I shouldn't use SSH how will I configure my ESX host?
There are several supported methods for configuring ESX and vCenter Server, through both GUI and API/CLI interfaces:
- Host Profiles
- Configuration Profiles
- PowerCLI
- esxcli
- SDDC Manager

The developer.broadcom.com site provides numerous examples and options in various scripting and programming languages. By managing ESX through vCenter Server, you can also leverage vCenter's comprehensive role-based access control (RBAC) capabilities.

## Can I disable SSH if it is enabled?
Yes, and we recommend doing so to improve security and reduce audit scope. Please consult the vSphere documentation and [Security Configuration Guide](https://brcm.tech/vcf-scg) for your version.

## Are there any problems with network-based scanning?
vSphere is a robust and mature infrastructure product that can handle routine network scanning. We recommend this testing progression:
1. Test your scanner in a test environment (nested ESX works well for this)
2. Scan a subset of production hosts in maintenance mode
3. Proceed to scanning your full environment

This approach builds confidence and helps you evaluate results more effectively.

## Is there a way to limit users logging in to ESX?
Yes, you can control access through:
- The DCUI.Access advanced option
- Lockdown Mode
- Shell access restrictions (new in ESX 8.0.0)

We recommend:
1. Limiting ESX shell access to staff directly involved with hardware support
2. Carefully considering dependencies to ensure support teams can recover systems during incidents
3. Having staff interact with ESX through vCenter Server to leverage its comprehensive role-based access control (RBAC)

Note that disabling local account shell access (ESX 8.0.0+) can have side effects. For detailed guidance, consult the vSphere 8 [Security Configuration Guide](https://brcm.tech/vcf-scg).

## Are there default accounts created on vCenter Server or ESX?
Yes, there are several default accounts:

For vCenter Server:
- administrator@vsphere.local (or your specified domain) is created during installation with your specified password

For ESX:
- 'root' account with installation-specified password
- 'vpxuser' account for privilege separation
- 'dcui' account for console application access

Additional service accounts exist in appliances like vCenter Server for privilege separation and least privilege implementation.

System accounts in Linux-based appliances are secured by default, with locked passwords and login-prevented shells (/sbin/nologin or /bin/false).

For comprehensive information about default accounts and their purposes, please refer to [Default Accounts in vSphere 8](https://github.com/vmware/vcf-security-and-compliance-guidelines/blob/main/regulatory-compliance/vsphere/8.0/VMware-vSphere-8-Default-Accounts.md).

## My compliance folks are insisting that they be granted SSH access to vSphere. What do I tell them?
SSH is a troubleshooting and support interface that is:
- Not enabled in default installations
- Only intended for temporary use during troubleshooting
- Unable to implement least-privilege access due to ESX Shell's permission model

Important points to consider:
1. There are no user-serviceable components accessible via SSH
2. Component replacement through SSH voids support
3. VCF components and appliances must be evaluated as complete units
4. Enabling SSH reduces security and increases attack surface
5. Vendor best practices and documentation explicitly recommend keeping SSH disabled

Compliance implications:
1. Enabling SSH for scanning typically generates false findings
2. This wastes staff time and increases audit costs with no security benefit
3. It creates a paradox where auditors request a configuration that their own audit will then flag as insecure
4. These findings would not exist if SSH remained disabled as designed

This situation is analogous to storage array controllers, where vendors don't permit access even though SSH may be running for support purposes.

Consider scanning environments in their standard operational state. Enabling SSH for scanning:
- Decreases security
- Increases management complexity
- Goes against vendor recommendations
- Creates artificial compliance issues

## If we still want to scan VCF components and appliances via SSH, what's the best way?
We strongly recommend using a test environment for this purpose, at least to start. You can:
1. Deploy a secondary, non-production vCenter Server
2. Install ESX inside virtual machines (nested ESX)
3. Use identical software versions to your production environment
4. Create representative configurations
5. Leverage snapshots when the nested environment is powered off for easy testing rollback

This approach minimizes the risk of operational and support incidents in your production environments. We also strongly recommend read-only access to the production environment, to avoid any unintended changes. Do not give compliance scanners full administrative access to your production environment. Besides, most organizational access policies prohibit sharing of credentials. Create a separate user account for compliance scanning, assign it read-only access, and use that account to scan your production environment.

Note: While nested vSphere (used in VMware Hands-on Labs) makes this testing possible, it is not supported by VMware Global Support. However, numerous community resources exist for creating these test environments.

## Disclaimer
This repository and information contained within is intended to provide general guidance for organizations that are considering Broadcom solutions. The information contained in this document is for educational and informational purposes only. This document is not intended to provide advice and is provided “AS IS.” Broadcom makes no claims, promises, or guarantees about the accuracy, completeness, or adequacy of the information contained herein. Organizations should engage appropriate legal, business, technical, and audit expertise within their specific organization for review of requirements and effectiveness of implementations.